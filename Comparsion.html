<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Comparsion</title>
    <link rel="stylesheet" href="./css/style.css"/>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAvz3wtF_zua_MODBHMJ47fngkypJ65nck",
        authDomain: "outfit-doesfit.firebaseapp.com",
        databaseURL: "https://outfit-doesfit.firebaseio.com",
        projectId: "outfit-doesfit",
        storageBucket: "outfit-doesfit.appspot.com",
        messagingSenderId: "59868218098"
      };
      firebase.initializeApp(config);
    </script>
  </head>
  <body>

      <nav>
          <div id="companyName">
            OutFit DoesFit
          </div>
        <ul>
            <li class="navLink"><a href="Create_Account.html">Register</a></li>
            <li class="navLink"><a href="Login.html">Login</a></li>
            <li class="navLink"><a href="Comparsion.html">Fitting Room</a></li>
            <li class="navLink"><a href="Sizing.html">Sizing</a></li>
            <li class="navLink"><a href="Shopping_Page.html">Shopping</a></li>
          </ul>
      </nav>

      <div id="content">
        <div class="spacer">

        </div>
        <div class="boxContainer">
          <div class="box">
            <h4>Your Size</h4>
          </div>
          <div class="box">
            <h4>How much bigger or small?</h4>
          </div>
          <div class="box">
            <h4>Selected clothes from fitting room</h4>
          </div>
        </div>

        <div class="boxContainer">
          <div class="box">
            <img id="left" src="./images/yourSize.PNG" alt="rightImage">
          </div>
          <div class="box">
            <img id="middle" src="./images/middleImage.jpg" alt="middleImage">
          </div>
          <div class="box">
            <img id="right" src="./images/noItemFound.png" alt="leftImage">
          </div>
        </div>

        <div class="boxContainer">
          <div class="box">
            <button class="button" type="button" name="editButton" onclick="location.href='Sizing.html';">EDIT</button>
          </div>
          <div class="box">
            <div id="centerBottom">
              <h4>Recommended Size</h4>
              <div class="boxContainer">
                <div class="box"></div>
                <div class="box" id="size">M</div>
                <div class="box"></div>
              </div>
            </div>
          </div>
            <div class="box">
              <h4 id="brandName">Banana Republic</h4>
              <div class="boxContainer">
                <div class="box">
                  <button class="button" type="button" name="lastButton" id="lastButton">Previous</button>
                </div>
                <div class="box">
                  <button class="button" type="button" name="removeButton" id="removeButton">Remove</button>
                </div>
                <div class="box">
                  <button class="button" type="button" name="nextButton" id="nextButton">Next</button>
                </div>
              </div>
            </div>
        </div>

        <div class="spacer">
        </div>

        <div class="boxContainer">
          <div class="box">
            <!-- <button class="button" type="button" name="backButton">BACK</button> -->
          </div>
          <div class="box">

          </div>
          <div class="box">
            <button class="button" type="button" name="shopButton">Shop</button>
          </div>
        </div>
      </div>
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script>

      $(document).ready(function(){
        var currentSelection = 0;
        var arrayClothSelection = [];
        var arrayCurrentObj= [];
        var starCountRef = firebase.database().ref('/Clothing');
        var dbUsers = firebase.database().ref('/users');

        function runUser(){
          dbUsers.on('value', function(snapshot){
            var userObj = snapshot.val();
            console.log(userObj);
            var bandSize = userObj.yourAddiasSize;
            $('#size').text(bandSize);
            console.log(bandSize);
          });
        }

        function run(callback) {
        starCountRef.on('value', function(snapshot) {
          var clothingObject = snapshot.val();
          // console.log(clothingObject);

          for(var currentObj in clothingObject) {
            var clothing = clothingObject[currentObj];
            console.log(clothing.fittingRoom);
            if(clothing.fittingRoom == "true") {
              // console.log(clothing);
              arrayClothSelection.push(clothing);
              arrayCurrentObj.push(currentObj);

            }
          }
          callback();

        });
      }
        // var clothObj = arrayClothSelection[0];
        // console.log(clothObj);

        // console.log(arrayClothSelection);

        // function sleep(ms) {
        //   return new Promise(resolve => setTimeout(resolve, ms));
        // };
        // async function demo() {
        //   console.log('Taking a break...');
        //   await sleep(1000);
        //   console.log('one seconds later');
        //
        //   if (arrayClothSelection.length == 0){
        //     $('#right').attr('src', "./images/noItemFound.png");
        //
        //   }else{
        //   var clothObj = arrayClothSelection[currentSelection];
        //   var urlClothObj = clothObj.url;
        //   console.log(arrayClothSelection);
        //   $('#right').attr('src', urlClothObj);
        // }
        // };

        function initalizeAddingClothing(){
          if (arrayClothSelection.length == 0){
            $('#right').attr('src', "./images/noItemFound.png");
            $('#brandName').text("None Selected");
          }else{
            var clothObj = arrayClothSelection[currentSelection];
            var urlClothObj = clothObj.url;
            var bandName = clothObj.Brand;
            console.log(arrayClothSelection);
            $('#right').attr('src', urlClothObj);
            $('#brandName').text(bandName);

        }
      };
        run(initalizeAddingClothing);
        runUser();
        // demo();
        console.log(arrayCurrentObj);

        $("#removeButton").on("click", function(event){
          console.log("clicked",$(this));
          var shirt = arrayCurrentObj[currentSelection];
          firebase.database().ref("/Clothing/" + shirt).update({
            fittingRoom: "false"
          });

          arrayClothSelection.splice(currentSelection, 1);
          arrayCurrentObj.splice(currentSelection, 1);
          console.log(arrayClothSelection);
          console.log(arrayCurrentObj);

          if (arrayClothSelection.length == 0){
            $('#right').attr('src', "./images/noItemFound.png");
            $('#brandName').text("None Selected");
          }else{
            var clothObj = arrayClothSelection[currentSelection];
            var urlClothObj = clothObj.url;
            var bandName = clothObj.Brand;
            console.log(clothObj);
            $('#right').attr('src', urlClothObj);
            $('#brandName').text(bandName);
          }
          document.location.reload(true);
        });

        $("#lastButton").on("click", function(event){
          console.log("clicked",$(this));
          if (currentSelection != 0){
            currentSelection --;
            var shirt = arrayCurrentObj[currentSelection];

            if (arrayClothSelection.length == 0){
              $('#right').attr('src', "./images/noItemFound.png");
              $('#brandName').text("None Selected");

            }else{
              var clothObj = arrayClothSelection[currentSelection];
              var urlClothObj = clothObj.url;
              var bandName = clothObj.Brand;
              console.log(clothObj);
              console.log(currentSelection);
              $('#right').attr('src', urlClothObj);
              $('#brandName').text(bandName);
            }

          }

        });

        $("#nextButton").on("click", function(event){
          console.log("clicked",$(this));

          if (currentSelection != (arrayClothSelection.length - 1)){
            currentSelection ++;
            var shirt = arrayCurrentObj[currentSelection];

            if (arrayClothSelection.length == 0){
              $('#right').attr('src', "./images/noItemFound.png");
              $('#brandName').text("None Selected");
            }else{
              var clothObj = arrayClothSelection[currentSelection];
              var urlClothObj = clothObj.url;
              var bandName = clothObj.Brand;
              console.log(clothObj);
              console.log(currentSelection);
              $('#right').attr('src', urlClothObj);
              $('#brandName').text(bandName);
            }
          }
        });




      });

      </script>
  </body>
</html>
